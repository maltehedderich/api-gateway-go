# ========================================
# API Gateway - Terraform Configuration
# ========================================
# Copy this file to terraform.tfvars and customize for your environment

# ========================================
# Required Configuration
# ========================================

aws_region   = "us-east-1"
environment  = "dev"
project_name = "api-gateway"

# ========================================
# JWT Authorization (REQUIRED if enabled)
# ========================================

enable_jwt_authorizer = true

# JWT issuer URL - MUST match the 'iss' claim in your JWT tokens
# Example: https://auth.example.com, https://your-auth0-domain.auth0.com/
jwt_issuer = "https://auth.example.com"

# JWT audience - MUST match the 'aud' claim in your JWT tokens
jwt_audience = ["api-gateway"]

# JWT identity source - where to extract JWT from request
# Options:
#   - "$request.header.Authorization" (default, Bearer token)
#   - "$request.header.X-Api-Key"
#   - "$request.querystring.token"
jwt_identity_source = "$request.header.Authorization"

# ========================================
# API Gateway Configuration
# ========================================

# Throttling limits (protects backend from overload)
api_gateway_throttle_burst_limit = 100  # Max concurrent requests
api_gateway_throttle_rate_limit  = 50   # Requests per second

# Logging
enable_api_gateway_logs         = true
api_gateway_log_retention_days  = 7  # Options: 1, 3, 5, 7, 14, 30, 60, 90, 120, 150, 180, 365, 400, 545, 731, 1827, 3653

# ========================================
# Lambda Configuration
# ========================================

lambda_runtime      = "provided.al2023"  # For Go custom runtime
lambda_memory_size  = 256                # MB (128-10240)
lambda_timeout      = 10                 # Seconds (1-900)

lambda_log_retention_days = 7

# Concurrent execution limit (-1 = unreserved)
lambda_reserved_concurrent_executions = -1

# Environment variables for Lambda functions
lambda_environment_variables = {
  LOG_LEVEL              = "info"
  DYNAMODB_TABLE_USERS   = "api-gateway-dev-users"
  DYNAMODB_TABLE_ORDERS  = "api-gateway-dev-orders"
}

# ========================================
# DynamoDB Configuration
# ========================================

enable_dynamodb  = true
dynamodb_billing_mode = "PAY_PER_REQUEST"  # Options: PAY_PER_REQUEST, PROVISIONED

# Production settings (set to true for production)
dynamodb_point_in_time_recovery = false  # Enable continuous backups
dynamodb_deletion_protection    = false  # Prevent accidental deletion

# Table configurations (customize as needed)
dynamodb_tables = {
  users = {
    hash_key = "user_id"
    attributes = [
      { name = "user_id", type = "S" },
      { name = "email", type = "S" }
    ]
    global_secondary_indexes = [
      {
        name            = "email-index"
        hash_key        = "email"
        projection_type = "ALL"
      }
    ]
  }
  orders = {
    hash_key  = "order_id"
    range_key = "created_at"
    attributes = [
      { name = "order_id", type = "S" },
      { name = "created_at", type = "N" },
      { name = "user_id", type = "S" }
    ]
    global_secondary_indexes = [
      {
        name            = "user-orders-index"
        hash_key        = "user_id"
        range_key       = "created_at"
        projection_type = "ALL"
      }
    ]
  }
}

# ========================================
# CORS Configuration
# ========================================

enable_cors = true

# Allowed origins (restrict in production)
cors_allow_origins = ["*"]  # Production: ["https://example.com"]

cors_allow_methods = ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
cors_allow_headers = ["Content-Type", "Authorization", "X-Amz-Date", "X-Api-Key", "X-Amz-Security-Token"]
cors_max_age       = 86400  # 24 hours

# ========================================
# Custom Domain (Optional)
# ========================================

enable_custom_domain = false

# Uncomment and configure if using a custom domain:
# domain_name     = "api.example.com"
# certificate_arn = "arn:aws:acm:us-east-1:123456789012:certificate/12345678-1234-1234-1234-123456789012"
# route53_zone_id = "Z1234567890ABC"

# Note: ACM certificate must be in the same region as API Gateway
# For Regional API Gateway, certificate must be in deployment region
# For Edge-optimized API Gateway, certificate must be in us-east-1

# ========================================
# Common Tags
# ========================================

common_tags = {
  Project     = "api-gateway"
  Environment = "dev"
  ManagedBy   = "terraform"
  CostCenter  = "engineering"
  Owner       = "platform-team"
}

# ========================================
# Environment-Specific Examples
# ========================================

# Development Environment
# -----------------------
# environment                         = "dev"
# api_gateway_throttle_rate_limit     = 50
# lambda_memory_size                  = 256
# lambda_log_retention_days           = 7
# dynamodb_point_in_time_recovery     = false
# dynamodb_deletion_protection        = false
# cors_allow_origins                  = ["*"]

# Staging Environment
# -------------------
# environment                         = "staging"
# api_gateway_throttle_rate_limit     = 100
# lambda_memory_size                  = 512
# lambda_log_retention_days           = 14
# dynamodb_point_in_time_recovery     = true
# dynamodb_deletion_protection        = false
# cors_allow_origins                  = ["https://staging.example.com"]

# Production Environment
# ----------------------
# environment                         = "prod"
# api_gateway_throttle_rate_limit     = 500
# lambda_memory_size                  = 1024
# lambda_log_retention_days           = 30
# dynamodb_point_in_time_recovery     = true
# dynamodb_deletion_protection        = true
# cors_allow_origins                  = ["https://example.com"]
# enable_custom_domain                = true
