# Staging Configuration
# This configuration mimics production but with relaxed settings

server:
  http_port: 8080
  https_port: 8443
  tls_enabled: true
  tls_cert_file: /etc/gateway/certs/tls.crt
  tls_key_file: /etc/gateway/certs/tls.key
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s
  handler_timeout: 30s
  max_header_bytes: 1048576  # 1 MB
  shutdown_timeout: 30s
  enable_http2: true
  trusted_proxies:
    - 10.0.0.0/8
    - 172.16.0.0/12

logging:
  level: info
  format: json
  output: stdout
  sanitize_patterns:
    - "(?i)password"
    - "(?i)token"
    - "(?i)secret"
    - "(?i)api[_-]?key"
    - "(?i)authorization"
    - "(?i)cookie"
  component_levels: {}
  enable_sampling: false
  sampling_rate: 1.0

authorization:
  enabled: true
  cookie_name: session_token
  jwt_signing_algorithm: RS256
  jwt_public_key_file: /etc/gateway/keys/public.pem
  clock_skew_tolerance: 5s
  required_claims:
    - sub
    - exp
    - iat
  revocation_list_url: http://auth-service:8080/api/v1/revocations
  revocation_list_cache: 30s
  cache_auth_decisions: true
  cache_decision_ttl: 5m

rate_limit:
  enabled: true
  backend: redis
  redis_addr: redis:6379
  redis_password: ""
  redis_db: 0
  failure_mode: fail-open  # Fail open in staging for availability
  global_limits:
    - key: ip
      limit: 1000
      window: 1m
      burst: 100

routes:
  - path_pattern: /api/v1/users
    methods:
      - GET
      - POST
    backend_url: http://user-service:8080
    timeout: 10s
    auth_policy: authenticated
    rate_limits:
      - key: user
        limit: 100
        window: 1m
        burst: 20

  - path_pattern: /api/v1/orders
    methods:
      - GET
      - POST
      - PUT
      - DELETE
    backend_url: http://order-service:8080
    timeout: 15s
    auth_policy: authenticated
    rate_limits:
      - key: user
        limit: 50
        window: 1m
        burst: 10

  - path_pattern: /api/v1/admin
    methods:
      - GET
      - POST
      - PUT
      - DELETE
    backend_url: http://admin-service:8080
    timeout: 30s
    auth_policy: role-based
    required_roles:
      - admin
    rate_limits:
      - key: user
        limit: 200
        window: 1m
        burst: 50

observability:
  metrics_enabled: true
  metrics_port: 9090
  metrics_path: /metrics
  health_path: /_health
  readiness_path: /_health/ready
  liveness_path: /_health/live
  tracing_enabled: true
  tracing_endpoint: http://jaeger:14268/api/traces
